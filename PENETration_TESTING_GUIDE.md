# FocusFlow ペネトレーションテストガイド (Kali Linux使用)

## ⚠️ 免責事項

このガイドは、**自身が開発・管理するアプリケーション**に対して、セキュリティ上の脆弱性を発見し、改善することのみを目的としています。許可なく第三者のウェブサイトやシステムに対してこのガイドに記載されているテストを行うことは、法律で固く禁じられています。すべてのテストは、自己責任の範囲で、管理下のテスト環境で実施してください。

---

## 1. はじめに

ペネトレーションテスト（侵入テスト）は、攻撃者の視点からシステムを擬似的に攻撃し、セキュリティ上の脆弱性を見つけ出すための重要なプロセスです。このガイドでは、Kali Linuxにプリインストールされているツールを使い、FocusFlowアプリケーションの基本的な脆弱性を診断する方法を解説します。

## 2. テスト環境のセットアップ

1.  **Kali Linuxの準備**:
    *   VirtualBoxやVMwareなどの仮想環境にKali Linuxをインストールし、実行します。

2.  **ネットワーク設定**:
    *   Kali LinuxのVMと、FocusFlowアプリケーションを実行するホストマシンが相互に通信できるように、ネットワーク設定を「ブリッジアダプター」または「ホストオンリーアダプター」に設定します。

3.  **FocusFlowの起動**:
    *   `run.py` を開き、`socketio.run` のホストを `0.0.0.0` に設定して、Kali Linuxからアクセスできるようにします。
        ```python
        # run.py
        if __name__ == '__main__':
            socketio.run(app, host='0.0.0.0', port=80)
        ```
    *   ホストマシンのIPアドレス（例: `192.168.1.10`）を確認し、Kali Linuxのブラウザから `http://<ホストのIPアドレス>` にアクセスして、アプリケーションが表示されることを確認します。

## 3. テストのフェーズ

### フェーズ1: 情報収集

まず、ターゲットについて可能な限りの情報を集めます。

*   **ポートスキャン (`nmap`)**: どのようなサービス（ポート）が外部に公開されているかを確認します。
    ```bash
    # -sV: バージョン情報, -p-: 全ポートをスキャン
    nmap -sV -p- <ホストのIPアドレス>
    ```
    HTTP(80/tcp)が開いていることが確認できるはずです。

*   **ディレクトリとファイルの探索 (`gobuster`)**: 隠されたパスや設定ファイルを探します。
    ```bash
    # -u: ターゲットURL, -w: 使用する辞書ファイル
    gobuster dir -u http://<ホストのIPアドレス> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
    ```
    `/login`, `/register`, `/dashboard` などの既知のパスが見つかるはずです。想定外のパスがないか確認します。

### フェーズ2: 脆弱性診断

収集した情報を元に、具体的な脆弱性を探します。

#### A. SQLインジェクション

**目的**: データベースの不正操作が可能かテストします。
**ツール**: `sqlmap`

FocusFlowはSQLAlchemy ORMを使用しているため、SQLインジェクションの脆弱性を持つ可能性は低いですが、テストは重要です。

```bash
# ログインフォームをターゲットにテストを実行
sqlmap -u http://<ホストのIPアドレス>/login --forms --batch
```

`--forms`でページ内のフォームを自動検出し、`--batch`で対話なしでテストを実行します。脆弱性が見つからなければ、「all tested parameters do not appear to be injectable」といったメッセージが表示されます。

#### B. クロスサイトスクリプティング (XSS)

**目的**: ユーザーのブラウザで不正なスクリプトが実行可能かテストします。
**テスト箇所**: ユーザーが入力したテキストが表示される全ての場所。
*   ユーザー登録時の「ユーザー名」
*   フォーカスセッション開始時の「タスク名」
*   フォーカスルーム作成時の「ルーム名」「説明」
*   ルーム内のチャット

**テスト方法**:
上記の入力欄に、以下のような簡単なスクリプトを入力してみます。

```html
<script>alert('XSS');</script>
<img src=x onerror=alert(1)>
```

入力後にページを再読み込みしたり、他のユーザーとしてそのページを表示した際に、アラートが表示されれば脆弱性があります。FocusFlowはJinja2テンプレートエンジンが自動でエスケープ処理を行うため、基本的には安全なはずですが、確認は不可欠です。

#### C. 認証とセッション管理

**目的**: パスワードの強度やセッションの安全性などを確認します。
**ツール**: `Burp Suite` (Community Edition)

1.  **Burp Suiteを起動**し、プロキシとして設定します（KaliのFirefoxにはFoxyProxy拡張機能が便利です）。
2.  **Intercept is on**の状態でFocusFlowにログインします。
3.  HTTPリクエストがBurp Suiteに表示されるので、`Cookie`ヘッダーを確認します。
    *   `session`クッキーに `HttpOnly` 属性が付与されているか確認します。（これによりJavaScriptからのアクセスを防ぎます）
    *   `Secure` 属性が付与されているか確認します。（HTTPS通信時のみクッキーを送信します）
4.  **パスワードの強度**: ユーザー登録時に「password」のような簡単なパスワードが設定できてしまうことを確認します。これは低リスクの脆弱性として報告できます。

### フェーズ3: レポート作成

テストで発見した脆弱性、その再現手順、考えられる影響、そして具体的な修正案をまとめてレポートを作成します。このドキュメントが、アプリケーションをより安全にするための重要な資料となります。

---

## 4. まとめ

このガイドはペネトレーションテストの入り口にすぎません。実際のテストはより多岐にわたり、深い知識が要求されます。しかし、基本的なテストを自分で行うことで、開発者自身がセキュリティ意識を高め、より安全なアプリケーションを構築する大きな一歩となります。
