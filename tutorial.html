<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusFlow開発チュートリアル (Python & Flask版)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="main-layout">
        <aside class="sidebar">
            <h3>目次</h3>
            <ul>
                <li><a href="#intro">はじめに</a></li>
                <li><a href="#section-1">1. 環境構築</a></li>
                <li><a href="#section-2">2. プロジェクトのセットアップ</a></li>
                <li><a href="#section-3">3. データベースモデルの定義</a></li>
                <li><a href="#section-4">4. ルーティングとビューの作成</a></li>
                <li><a href="#section-5">5. HTMLテンプレートの作成</a></li>
                <li><a href="#section-6">6. アプリケーションの実行</a></li>
                <li><a href="#section-7">7. 今後の展望</a></li>
            </ul>
        </aside>

        <main class="container">
            <header>
                <h1>FocusFlow開発チュートリアル</h1>
                <p>Python & Flask を使用したMVP開発手順</p>
            </header>

            <section id="intro" class="card">
                <h2>はじめに</h2>
                <p>このチュートリアルでは、集中力育成SNS「FocusFlow」の基本的な機能をPythonのWebフレームワークであるFlaskを使用して開発する手順を解説します。まずはMVP(Minimum Viable Product)として、以下の機能を実装することを目指します。</p>
                <ul>
                    <li>ユーザー登録・ログイン機能</li>
                    <li>集中セッションの記録（タスク名、時間）</li>
                    <li>集中履歴の表示ダッシュボード</li>
                </ul>
            </section>

            <section id="section-1" class="card">
                <h2>1. 環境構築</h2>
                
                <h3>Pythonのインストール</h3>
                <p>お使いのシステムにPython 3がインストールされていることを確認してください。まだの場合は、<a href="https://www.python.org/" target="_blank">公式サイト</a>からダウンロードしてインストールします。</p>

                <h3>仮想環境の作成と有効化</h3>
                <p>プロジェクトごとに環境を分離するため、仮想環境を作成します。</p>
                <pre><code># プロジェクトディレクトリを作成
mkdir focus-flow-app
cd focus-flow-app

# 仮想環境を作成 (Windows)
python -m venv venv

# 仮想環境を有効化 (Windows)
.\venv\Scripts\activate</code></pre>

                <h3>必要なライブラリのインストール</h3>
                <p>Flaskと、データベースを扱うためのFlask-SQLAlchemy、パスワードをハッシュ化するためのWerkzeugなどをインストールします。</p>
                <pre><code>pip install Flask Flask-SQLAlchemy Flask-Login Werkzeug</code></pre>
            </section>

            <section id="section-2" class="card">
                <h2>2. プロジェクトのセットアップ</h2>
                <p>Flaskアプリケーションの基本的な構造を作成します。</p>

                <h3>ディレクトリ構成</h3>
                <p>以下のようなディレクトリ構成を作成します。</p>
                <pre><code>focus-flow-app/
├── app/
│   ├── __init__.py
│   ├── models.py
│   ├── routes.py
│   ├── static/
│   └── templates/
│       ├── base.html
│       ├── login.html
│       ├── register.html
│       └── dashboard.html
└── run.py</code></pre>

                <h3>`run.py` の作成</h3>
                <p>アプリケーションを起動するためのファイルです。</p>
                <pre><code>from app import create_app

app = create_app()

if __name__ == '__main__':
    app.run(debug=True)</code></pre>

                <h3>`app/__init__.py` の作成</h3>
                <p>Flaskアプリケーションのインスタンスを作成し、各種設定を行います。</p>
                <pre><code>from flask import Flask
from flask_sqlalchemy import SQLAlchemy
from flask_login import LoginManager

db = SQLAlchemy()
login_manager = LoginManager()

def create_app():
    app = Flask(__name__)
    app.config['SECRET_KEY'] = 'your_secret_key'
    app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///db.sqlite'
    app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False

    db.init_app(app)
    login_manager.init_app(app)
    login_manager.login_view = 'main.login'

    from .models import User
    @login_manager.user_loader
    def load_user(user_id):
        return User.query.get(int(user_id))

    from .routes import main as main_blueprint
    app.register_blueprint(main_blueprint)

    with app.app_context():
        db.create_all()

    return app</code></pre>
            </section>
            
            <section id="section-3" class="card">
                <h2>3. データベースモデルの定義</h2>
                <p>`app/models.py` に、ユーザーと集中セッションのデータを保存するためのテーブルを定義します。</p>
                <pre><code>from flask_login import UserMixin
from . import db
from werkzeug.security import generate_password_hash, check_password_hash

class User(UserMixin, db.Model):
    id = db.Column(db.Integer, primary_key=True)
    email = db.Column(db.String(100), unique=True, nullable=False)
    username = db.Column(db.String(100), nullable=False)
    password_hash = db.Column(db.String(128))
    sessions = db.relationship('FocusSession', backref='author', lazy=True)

    def set_password(self, password):
        self.password_hash = generate_password_hash(password)

    def check_password(self, password):
        return check_password_hash(self.password_hash, password)

class FocusSession(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    task_name = db.Column(db.String(200), nullable=False)
    duration_minutes = db.Column(db.Integer, nullable=False)
    timestamp = db.Column(db.DateTime, server_default=db.func.now())
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)</code></pre>
            </section>

            <section id="section-4" class="card">
                <h2>4. ルーティングとビューの作成</h2>
                <p>`app/routes.py` に、各URLに対応する処理（ビュー関数）を記述します。</p>
                <pre><code>from flask import Blueprint, render_template, redirect, url_for, request, flash
from flask_login import login_user, logout_user, login_required, current_user
from .models import User, FocusSession
from . import db

main = Blueprint('main', __name__)

@main.route('/')
def index():
    return redirect(url_for('main.dashboard'))

@main.route('/register', methods=['GET', 'POST'])
def register():
    if request.method == 'POST':
        email = request.form.get('email')
        username = request.form.get('username')
        password = request.form.get('password')

        user = User.query.filter_by(email=email).first()
        if user:
            flash('このメールアドレスは既に使用されています。')
            return redirect(url_for('main.register'))

        new_user = User(email=email, username=username)
        new_user.set_password(password)

        db.session.add(new_user)
        db.session.commit()

        login_user(new_user)
        return redirect(url_for('main.dashboard'))
    return render_template('register.html')

@main.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        email = request.form.get('email')
        password = request.form.get('password')
        remember = True if request.form.get('remember') else False

        user = User.query.filter_by(email=email).first()

        if not user or not user.check_password(password):
            flash('メールアドレスまたはパスワードが正しくありません。')
            return redirect(url_for('main.login'))

        login_user(user, remember=remember)
        return redirect(url_for('main.dashboard'))
    return render_template('login.html')

@main.route('/logout')
@login_required
def logout():
    logout_user()
    return redirect(url_for('main.login'))

@main.route('/dashboard')
@login_required
def dashboard():
    sessions = FocusSession.query.filter_by(user_id=current_user.id).order_by(FocusSession.timestamp.desc()).all()
    return render_template('dashboard.html', username=current_user.username, sessions=sessions)

@main.route('/start_session', methods=['POST'])
@login_required
def start_session():
    task_name = request.form.get('task_name')
    duration_minutes = request.form.get('duration_minutes')

    if not task_name or not duration_minutes:
        flash('タスク名と時間を入力してください。')
        return redirect(url_for('main.dashboard'))

    new_session = FocusSession(
        task_name=task_name,
        duration_minutes=int(duration_minutes),
        author=current_user
    )
    db.session.add(new_session)
    db.session.commit()

    return redirect(url_for('main.dashboard'))</code></pre>
            </section>

            <section id="section-5" class="card">
                <h2>5. HTMLテンプレートの作成</h2>
                <p>ユーザーがブラウザで見る画面を作成します。コードブロック内はFlaskテンプレートの構文を含んだHTMLです。</p>
                <h3>`app/templates/base.html` (共通レイアウト)</h3>
                <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;{% block title %}FocusFlow{% endblock %}&lt;/title&gt;
    &lt;style&gt;
        /* 簡単なスタイリング */
        body { font-family: sans-serif; margin: 2em; }
        nav { margin-bottom: 1em; }
        .flash { background: #cee5f5; padding: 0.5em; border: 1px solid #aacbe2; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;nav&gt;
        &lt;h1&gt;FocusFlow&lt;/h1&gt;
        {% if current_user.is_authenticated %}
            &lt;a href="{{ url_for('main.dashboard') }}"&gt;ダッシュボード&lt;/a&gt;
            &lt;a href="{{ url_for('main.logout') }}"&gt;ログアウト&lt;/a&gt;
        {% else %}
            &lt;a href="{{ url_for('main.login') }}"&gt;ログイン&lt;/a&gt;
            &lt;a href="{{ url_for('main.register') }}"&gt;登録&lt;/a&gt;
        {% endif %}
    &lt;/nav&gt;
    &lt;hr&gt;
    {% with messages = get_flashed_messages() %}
    {% if messages %}
        &lt;ul class=flash&gt;
        {% for message in messages %}
            &lt;li&gt;{{ message }}&lt;/li&gt;
        {% endfor %}
        &lt;/ul&gt;
    {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
                <h3>`app/templates/register.html`</h3>
                <pre><code>{% extends "base.html" %}

{% block title %}ユーザー登録{% endblock %}

{% block content %}
    &lt;h2&gt;ユーザー登録&lt;/h2&gt;
    &lt;form method="POST" action="/register"&gt;
        &lt;p&gt;&lt;input type="email" name="email" placeholder="メールアドレス" required&gt;&lt;/p&gt;
        &lt;p&gt;&lt;input type="text" name="username" placeholder="ユーザー名" required&gt;&lt;/p&gt;
        &lt;p&gt;&lt;input type="password" name="password" placeholder="パスワード" required&gt;&lt;/p&gt;
        &lt;p&gt;&lt;button type="submit"&gt;登録&lt;/button&gt;&lt;/p&gt;
    &lt;/form&gt;
{% endblock %}
</code></pre>
                <h3>`app/templates/login.html`</h3>
                <pre><code>{% extends "base.html" %}

{% block title %}ログイン{% endblock %}

{% block content %}
    &lt;h2&gt;ログイン&lt;/h2&gt;
    &lt;form method="POST" action="/login"&gt;
        &lt;p&gt;&lt;input type="email" name="email" placeholder="メールアドレス" required&gt;&lt;/p&gt;
        &lt;p&gt;&lt;input type="password" name="password" placeholder="パスワード" required&gt;&lt;/p&gt;
        &lt;p&gt;&lt;input type="checkbox" name="remember"&gt; ログイン状態を維持する&lt;/p&gt;
        &lt;p&gt;&lt;button type="submit"&gt;ログイン&lt;/button&gt;&lt;/p&gt;
    &lt;/form&gt;
{% endblock %}
</code></pre>
                <h3>`app/templates/dashboard.html`</h3>
                <pre><code>{% extends "base.html" %}

{% block title %}ダッシュボード{% endblock %}

{% block content %}
    &lt;h2&gt;ようこそ, {{ username }} さん!&lt;/h2&gt;

    &lt;h3&gt;新しい集中セッションを開始&lt;/h3&gt;
    &lt;form method="POST" action="/start_session"&gt;
        &lt;p&gt;&lt;input type="text" name="task_name" placeholder="タスク名" required&gt;&lt;/p&gt;
        &lt;p&gt;&lt;input type="number" name="duration_minutes" placeholder="集中時間（分）" required&gt;&lt;/p&gt;
        &lt;p&gt;&lt;button type="submit"&gt;開始&lt;/button&gt;&lt;/p&gt;
    &lt;/form&gt;

    &lt;h3&gt;集中履歴&lt;/h3&gt;
    &lt;table border="1"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;タスク名&lt;/th&gt;
                &lt;th&gt;集中時間（分）&lt;/th&gt;
                &lt;th&gt;日時&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            {% for session in sessions %}
            &lt;tr&gt;
                &lt;td&gt;{{ session.task_name }}&lt;/td&gt;
                &lt;td&gt;{{ session.duration_minutes }}&lt;/td&gt;
                &lt;td&gt;{{ session.timestamp.strftime('%Y-%m-%d %H:%M') }}&lt;/td&gt;
            &lt;/tr&gt;
            {% endfor %}
        &lt;/tbody&gt;
    &lt;/table&gt;
{% endblock %}
</code></pre>
            </section>

            <section id="section-6" class="card">
                <h2>6. アプリケーションの実行</h2>
                <p>すべてのファイルを作成したら、ターミナルで以下のコマンドを実行してアプリケーションを起動します。</p>
                <pre><code># focus-flow-app ディレクトリにいることを確認
python run.py</code></pre>
                <p>ブラウザで <code>http://127.0.0.1:5000</code> にアクセスすると、アプリケーションが表示されます。</p>
            </section>

            <section id="section-7" class="card">
                <h2>7. 今後の展望</h2>
                <p>このチュートリアルで作成したMVPをベースに、「フォーカスフロー仕様.md」にあるさらに高度な機能を実装していくことができます。</p>
                <ul>
                    <li><strong>集中ゲージの実装</strong>: JavaScriptを使い、バックエンドと非同期通信（WebSocketやAjax）を行ってリアルタイムにゲージを更新します。</li>
                    <li><strong>デスクトップアプリ連携</strong>: Electronなどでデスクトップアプリ化し、`psutil`などのライブラリでアクティブなアプリケーションを検知して集中度を判定します。</li>
                    <li><strong>ソーシャル機能</strong>: ユーザー同士で「応援」を送る機能や、バーチャルな「集中ルーム」を作成します。</li>
                    <li><strong>AIによる分析</strong>: 蓄積された集中履歴データを分析し、ユーザーにフィードバックを返すAIコーチング機能を実装します。</li>
                </ul>
            </section>

            <footer>
                <p>&copy; 2025 FocusFlow Tutorial. All Rights Reserved.</p>
            </footer>
        </main>
    </div>

</body>
</html>
